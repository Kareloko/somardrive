<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>SomarDrive V18.3 üööüß†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0d1b3d">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
/* ===================== */
/*   VARIABLES GLOBALES  */
/* ===================== */
:root {
  --bg-dark: #020617;
  --card-bg: #1e293b;
  --accent: #3b82f6;
  --text: #f1f5f9;
  --green: #22c55e;
  --red: #ef4444;
  --yellow: #eab308;
  --wa: #25D366;
}

* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  margin: 0;
  padding: 0;
  font-family: 'Montserrat', sans-serif;
  background-color: var(--bg-dark);
  color: var(--text);
  padding-bottom: 140px;
}

.container {
  max-width: 600px;
  margin: 0 auto;
  padding: 15px;
}

/* ===================== */
/*   ENCABEZADO PRINCIPAL */
/* ===================== */
.app-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

.app-header-icon {
  width: 42px;
  height: 42px;
  border-radius: 8px;
  background: #1e3a8a;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.3rem;
}

.app-header-title {
  font-weight: 800;
  font-size: 1.4rem;
  letter-spacing: 1px;
}

/* ===================== */
/* BANNER DE DIOS */
/* ===================== */
.god-banner {
  background: linear-gradient(135deg, #1e3a8a, #172554);
  padding: 15px;
  border-radius: 12px;
  margin-bottom: 20px;
  text-align: center;
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.god-title {
  font-weight: 800;
  color: #fbbf24;
  font-size: 1.1rem;
  margin-bottom: 5px;
  text-transform: uppercase;
}

.god-text {
  font-size: 0.9rem;
  color: #e2e8f0;
  font-style: italic;
}

/* ===================== */
/*  BOTONES PRINCIPALES  */
/* ===================== */
.btn-main {
  padding: 13px;
  border-radius: 12px;
  font-weight: 700;
  border: none;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  text-shadow: 0 1px 2px rgba(0,0,0,0.4);
}

.btn-blue {
  background: linear-gradient(to bottom, #3b82f6, #2563eb);
  color: white;
}
.btn-gray {
  background: linear-gradient(to bottom, #475569, #334155);
  color: #dbeafe;
}
.btn-green {
  background: linear-gradient(to bottom, #22c55e, #16a34a);
  color: white;
}
.btn-red {
  background: linear-gradient(to bottom, #ef4444, #b91c1c);
  color: white;
}

/* ===================== */
/* PREVIEW FOTO */
/* ===================== */
#previewContainer {
  display: none;
  margin-top: 15px;
  border-radius: 10px;
  overflow: hidden;
  border: 2px solid #334155;
}
#preview { width: 100%; }

#ocrStatus {
  text-align: center;
  color: var(--accent);
  margin: 15px 0;
  font-weight: 700;
  display: none;
}

/* ===================== */
/*  EDITOR DE DIRECCIONES */
/* ===================== */
#editorSection {
  display: none;
  background: var(--card-bg);
  padding: 15px;
  border-radius: 15px;
  margin-top: 20px;
}

#linesContainer {
  max-height: 150px;
  overflow-y: auto;
  background: #0f172a;
  border-radius: 10px;
  padding: 5px;
  border: 1px solid rgba(255,255,255,0.1);
}

.line-item {
  padding: 7px;
  display: flex;
  gap: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

/* ===================== */
/* LISTA DE RUTA */
/* ===================== */
.card {
  background: var(--card-bg);
  border-radius: 12px;
  margin-bottom: 12px;
  padding: 14px;
  border-left: 5px solid var(--yellow);
}

/* ===================== */
/* BOT√ìN MEMORIA */
/* ===================== */
.memory-btn {
  background: var(--yellow);
  color: #111;
  padding: 6px 14px;
  border-radius: 999px;
  border: none;
  font-weight: 700;
}

/* ===================== */
/* FILA DE 4 BOTONES DESLIZABLE */
/* ===================== */
.backup-buttons-row {
  display: flex;
  gap: 10px;
  overflow-x: auto;
  padding-bottom: 8px;
  -webkit-overflow-scrolling: touch;
}

.backup-buttons-row .btn-main {
  flex: 0 0 auto;
  min-width: 150px;
  font-size: 0.85rem;
}

/* ===================== */
/* LOGO */
/* ===================== */
.logo-box {
  margin-top: 20px;
  display: flex;
  justify-content: center;
}
.logo-box img {
  width: 80%;
  max-width: 260px;
}

/* ===================== */
/* FOOTER */
/* ===================== */
.footer-static {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: #020617;
  padding: 6px;
  text-align: center;
}
.footer-static span {
  color: #ef4444;
  font-weight: 800;
}
</style>
</head>

<body>

<!-- ===================== -->
<!--   ENCABEZADO SOMAR DRIVE -->
<!-- ===================== -->
<div class="container">

  <div class="app-header">
    <div class="app-header-icon">üöö</div>
    <div class="app-header-title">SOMAR DRIVE</div>
  </div>

  <div class="god-banner">
    <div class="god-title">üëë EL PRIMER LUGAR ES DE DIOS</div>
    <div class="god-text">"Encomienda a Jehov√° tu camino, y conf√≠a en √©l; y √©l har√°."</div>
  </div>

  <!-- ===================== -->
  <!-- CAPTURAR IMAGEN -->
  <!-- ===================== -->
  <h2>üì∏ 1. Capturar direcciones</h2>

  <div style="display:flex; gap:10px;">
    <button class="btn-main btn-blue" onclick="document.getElementById('cameraInput').click()">üì∑ C√°mara</button>
    <button class="btn-main btn-gray" onclick="document.getElementById('fileInput').click()">üìÅ Galer√≠a</button>
  </div>

  <input type="file" id="cameraInput" accept="image/*" capture="environment" hidden onchange="processImage(this)">
  <input type="file" id="fileInput" accept="image/*" hidden onchange="processImage(this)">

  <div id="previewContainer"><img id="preview"></div>
  <div id="ocrStatus">‚è≥ Leyendo texto...</div>

  <!-- ===================== -->
  <!-- EDITOR -->
  <!-- ===================== -->
  <div id="editorSection">
    <h3>üìù 2. Selecciona l√≠neas</h3>
    <div id="linesContainer"></div>
    <textarea id="finalText" style="width:100%;height:80px;margin-top:10px;"></textarea>
    <button class="btn-main btn-green" onclick="saveAddress()">üíæ Guardar en Ruta</button>
  </div>

  <!-- ===================== -->
  <!-- RUTA + MEMORIA -->
  <!-- ===================== -->
  <div style="display:flex;justify-content:space-between;margin-top:20px;">
    <h2>üìç Ruta <span id="countPending">0</span></h2>
    <button id="historyBadge" class="memory-btn">Memoria: 0</button>
  </div>

  <div style="display:flex; gap:10px; margin-top:10px;">
    <button class="btn-main btn-gray" onclick="sortWithGPS()">üîÑ Ordenar GPS</button>
    <button class="btn-main btn-gray" onclick="toggleLiveTracking()">üõ∞Ô∏è Rastreo vivo</button>
  </div>

  <ul id="addressList" style="padding-left:0;"></ul>

  <!-- ===================== -->
  <!-- BACKUP + LOGO -->
  <!-- ===================== -->
  <h2 style="margin-top:35px;">üõ°Ô∏è Copias y Limpieza</h2>

  <div class="backup-buttons-row">
    <button class="btn-main btn-green" onclick="exportData()">‚¨áÔ∏è Descargar</button>
    <button class="btn-main btn-gray" onclick="document.getElementById('importInput').click()">‚¨ÜÔ∏è Cargar</button>
    <button class="btn-main btn-red" onclick="clearRoute()">üóëÔ∏è Borrar Ruta</button>
    <button class="btn-main btn-red" onclick="clearMemory()">üí£ Borrar Memoria</button>
  </div>

  <input type="file" id="importInput" accept=".json" hidden onchange="importData(this)">

  <div class="logo-box">
    <img src="somardrive_logo.png">
  </div>

</div>

<!-- ===================== -->
<!-- FOOTER -->
<!-- ===================== -->
<div class="footer-static"><span>‚ö†Ô∏è CONDUCE CON CUIDADO ‚Äî EN CASA TE ESPERAN</span></div>

<!-- ===================== -->
<!--         JS           -->
<!-- ===================== -->
<script>
/* ========================= */
/* VARIABLES */
const DB_KEY="SomarDrive_Route";
const HIST_KEY="SomarDrive_Memory";

let addresses=[];
let historyDB=[];

/* ========================= */
/* TOAST */
function showToast(m){alert(m);}

/* ========================= */
/* LOAD DATA */
window.onload=()=>{
  addresses=JSON.parse(localStorage.getItem(DB_KEY) || "[]");
  historyDB=JSON.parse(localStorage.getItem(HIST_KEY) || "[]");
  renderList();
  updateHistoryBadge();
};

/* ========================= */
/* SAVE DATA */
function saveData(){
  localStorage.setItem(DB_KEY,JSON.stringify(addresses));
  renderList();
}

function saveMem(){
  localStorage.setItem(HIST_KEY,JSON.stringify(historyDB));
  updateHistoryBadge();
}

/* ========================= */
/* OCR */
function processImage(input){
  if(!input.files[0])return;
  const file=input.files[0];
  document.getElementById("preview").src=URL.createObjectURL(file);
  previewContainer.style.display="block";
  ocrStatus.style.display="block";

  Tesseract.recognize(file,"ita").then(({data:{text}})=>{
    ocrStatus.style.display="none";
    showEditor(text);
  });
}

function showEditor(text){
  editorSection.style.display="block";
  linesContainer.innerHTML="";
  const lines=text.split("\n").map(l=>l.trim()).filter(l=>l.length>2);

  lines.forEach(x=>{
    const div=document.createElement("div");
    div.className="line-item";
    div.innerHTML=`<input type="checkbox" value="${x}" onchange="updateFinal()"><span>${x}</span>`;
    linesContainer.appendChild(div);
  });
}

function updateFinal(){
  const checks=[...linesContainer.querySelectorAll("input:checked")].map(c=>c.value);
  finalText.value=checks.join(", ");
}

/* ========================= */
/* SAVE ADDRESS */
function saveAddress(){
  const text=finalText.value.trim();
  if(!text)return showToast("Selecciona algo");
  addresses.unshift({text});
  saveData();
  editorSection.style.display="none";
}

/* ========================= */
/* RENDER LIST */
function renderList(){
  const UL=document.getElementById("addressList");
  UL.innerHTML="";
  document.getElementById("countPending").innerText=addresses.length;

  addresses.forEach((a,i)=>{
    const li=document.createElement("li");
    li.className="card";
    li.innerHTML=`
      <div>${a.text}</div>
      <button class="btn-main btn-green" onclick="markDelivered(${i})">‚úîÔ∏è Hecho</button>
      <button class="btn-main btn-red" onclick="deleteItem(${i})">üóëÔ∏è</button>
    `;
    UL.appendChild(li);
  });
}

/* ========================= */
/* DELETE */
function deleteItem(i){
  addresses.splice(i,1);
  saveData();
}

/* ========================= */
/* DELIVERED */
function markDelivered(i){
  addresses.splice(i,1);
  saveData();
  if(addresses.length===0) showToast("üéâ D√≠a completado");
}

/* ========================= */
/* MEMORY BUTTON */
function updateHistoryBadge(){
  document.getElementById("historyBadge").innerText="Memoria: "+historyDB.length;
}

document.getElementById("historyBadge").onclick=function(){
  if(!historyDB.length)return showToast("Memoria vac√≠a");
  let msg=historyDB.map((x,i)=>`${i+1}. ${x.text}`).join("\n");
  let n=prompt("MEMORIA:\n\n"+msg+"\n\nN√∫mero a usar:");
  if(!n)return;
  n=parseInt(n)-1;
  if(historyDB[n]) finalText.value=historyDB[n].text;
};

/* ========================= */
/* BACKUP */
function exportData(){
  const data=JSON.stringify(addresses);
  const blob=new Blob([data],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="somardrive_ruta.json";
  a.click();
}

function importData(input){
  const file=input.files[0];
  const reader=new FileReader();
  reader.onload=e=>{
    addresses=JSON.parse(e.target.result);
    saveData();
  };
  reader.readAsText(file);
}

function clearRoute(){
  addresses=[];
  saveData();
}

function clearMemory(){
  historyDB=[];
  saveMem();
}

/* ========================= */
/* GPS FUTURO */
function sortWithGPS(){showToast("GPS se agregar√° despu√©s");}
function toggleLiveTracking(){showToast("Rastreo vivo pronto");}
</script>

</body>
</html>
